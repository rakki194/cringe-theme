{{ $id := (.Get 0) }}
<div class="os-instructions">
    <div class="os-tabs">
        <button class="os-tab windows os-btn os-btn-windows active" data-os="windows">Windows</button>
        <button class="os-tab linux os-btn os-btn-linux" data-os="linux">Linux</button>
        <button class="os-tab mac os-btn os-btn-mac" data-os="mac">macOS</button>
    </div>
    <div class="os-content">
        <div class="os-section os-windows active" id="windows-{{ $id }}">
            {{ .Inner | replaceRE "<!-- linux -->[\\s\\S]*?<!-- mac -->" "" | replaceRE "<!-- mac -->[\\s\\S]*?" "" }}
        </div>
        <div class="os-section os-linux" id="linux-{{ $id }}">
            {{ .Inner | replaceRE "(?s).*?<!-- linux -->(.*?)<!-- mac -->.*" "$1" | safeHTML }}
        </div>
        <div class="os-section os-mac" id="mac-{{ $id }}">
            {{ .Inner | replaceRE "(?s).*?<!-- mac -->(.*)" "$1" | safeHTML }}
        </div>
    </div>
</div>

<script>
function selectOS(os, id) {
    try {
        // Hide all OS sections
        document.querySelectorAll(`.os-section[id$="-${id}"]`).forEach(section => {
            section.classList.remove('active');
        });
        
        // Show the selected OS section
        const selectedSection = document.getElementById(`${os}-${id}`);
        if (selectedSection) {
            selectedSection.classList.add('active');
        } else {
            console.warn(`Section with ID ${os}-${id} not found`);
            return; // Exit early if section not found
        }
        
        // Find the parent container
        const container = selectedSection.closest('.os-instructions');
        if (!container) {
            console.warn(`Container for ${id} not found`);
            return;
        }
        
        // Update tab classes within this container only
        container.querySelectorAll(`.os-tab`).forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Update the active tab within this container only
        container.querySelectorAll(`.os-tab.${os}`).forEach(tab => {
            tab.classList.add('active');
        });
        
        // Store the selection in localStorage
        localStorage.setItem('preferredOS', os);
    } catch (error) {
        console.error(`Error in selectOS function: ${error.message}`);
    }
}

// Make the initialization function run only once
if (!window.osInstructionsInitialized) {
    window.osInstructionsInitialized = true;
    
    document.addEventListener('DOMContentLoaded', function() {
        try {
            // Add click handlers to all OS tabs
            document.querySelectorAll('.os-tab').forEach(button => {
                button.addEventListener('click', function() {
                    const os = this.getAttribute('data-os');
                    const container = this.closest('.os-instructions');
                    const section = container.querySelector(`.os-section.os-${os}`);
                    if (section) {
                        const id = section.id.split('-').pop();
                        selectOS(os, id);
                    }
                });
            });
            
            // Set initial OS based on preference
            const preferredOS = localStorage.getItem('preferredOS') || 'windows';
            document.querySelectorAll('.os-instructions').forEach(container => {
                const sections = container.querySelectorAll('.os-section');
                if (sections.length > 0) {
                    // Get id from first section
                    const id = sections[0].id.split('-').pop();
                    selectOS(preferredOS, id);
                }
            });
        } catch (error) {
            console.error(`Error in OS initialization: ${error.message}`);
        }
    });
}
</script>

<style>
.os-instructions {
    margin: 1.5rem 0;
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid var(--gray-200);
}

.os-tabs {
    display: flex;
    background-color: var(--gray-100);
    border-bottom: 1px solid var(--gray-200);
}

.os-tab {
    padding: 0.5rem 1rem;
    border: none;
    background: none;
    cursor: pointer;
    font-weight: 500;
    color: var(--gray-600);
}

.os-tab:hover {
    background-color: var(--gray-200);
}

.os-tab.active {
    background-color: white;
    color: var(--primary-color);
    border-bottom: 2px solid var(--primary-color);
}

.os-content {
    padding: 1rem;
    background-color: white;
}

.os-section {
    display: none;
}

.os-section.active {
    display: block;
}

@media (prefers-color-scheme: dark) {
    .os-tabs {
        background-color: var(--gray-800);
        border-bottom: 1px solid var(--gray-700);
    }
    
    .os-tab {
        color: var(--gray-400);
    }
    
    .os-tab:hover {
        background-color: var(--gray-700);
    }
    
    .os-tab.active {
        background-color: var(--gray-900);
        color: var(--primary-color-light);
        border-bottom: 2px solid var(--primary-color-light);
    }
    
    .os-content {
        background-color: var(--gray-900);
    }
}
</style> 